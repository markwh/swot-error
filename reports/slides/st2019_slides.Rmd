---
title: "SWOT River Products"
author: "Mark Hagemann"
date: "6/12/2019"
output: 
  ioslides_presentation:
    incremental: true
---

```{r setup, include=FALSE}
library(knitr)
library(leaflet)
library(dplyr)

opts_chunk$set(echo = FALSE, eval = TRUE)

for (file in list.files("./rdata-bordeaux", full.names = TRUE)) {

  load(file)
}

```


## Overview

1. Short presentation of PIXC --> river products
2. Play time with example river products
3. Discussion

## HR Processing Flow

```{r}
include_graphics("fig-bordeaux/flowchart1.png", dpi = 130)
```

## HR Processing Flow

```{r}
include_graphics("fig-bordeaux/flowchart3.png", dpi = 200)
```


## HR Processing: PIXC --> river products

```{r}
include_graphics("fig-bordeaux/flowchart4.png")
```




## Sacramento River Simulations {.columns-2 .smaller}

```{r, fig.width = 3}
llet1 <- exnodedf0 %>%
  leaflet(sizingPolicy = leafletSizingPolicy(defaultWidth = "50%", 
                                             knitr.defaultWidth = "20%",
                                             browser.fill = FALSE)) %>% 
  addTiles() %>% 
  addCircles(~longitude, ~latitude, radius = 100, stroke = FALSE, fillOpacity = 0.8)
llet1
```

<br/>
<br/>
<br/>
<br/>
<br/>

Workflow:

- Obserrvations --> bathymetry, historic flow conditions
- HEC-RAS model --> water levels
- SLC simulator, PIXC processor --> Pixel clouds
  - Multiple passes
  - Multiple cycles

```{r}
include_graphics("fig-bordeaux/width-histogram.png", dpi = 200)
```

## Pixel Cloud

```{r}
include_graphics("fig-bordeaux/flowchart4-pixc.png")
```


## Pixel Cloud

```{r}
include_graphics("fig-bordeaux/exmap-base.png", dpi = 200)
```

- Zoom in to a small section of Sacramento



## Pixel Cloud {.smaller}

```{r}
include_graphics("fig-bordeaux/exmap-pixc.png")
```

- Already geolocated
- Already classified
- Contains height, area, water fraction, etc.


## Pixel Cloud


```{r}
include_graphics("fig-bordeaux/pixc-slantplane.png")
```

- Pixel cloud in slant plane (looks like pixels!)

## Prior Reach, Node database

```{r}
include_graphics("fig-bordeaux/flowchart4-priordb.png")
```


## Prior Reach, Node database

```{r}
include_graphics("fig-bordeaux/priormap-full.png")
```

- Freely available (thanks to Renato, Tamlin, Elizabeth)
- Get it [here](https://osu.app.box.com/s/0rvisixd9lung1nqxkjo3msl89z9nkvk)

## RiverObs

```{r}
include_graphics("fig-bordeaux/flowchart4-riverobs.png")
```


## RiverObs

```{r}
include_graphics("fig-bordeaux/riverobs-github3.png", dpi = 100)
```


- Open-source, on GitHub ([link](https://github.com/SWOTAlgorithms/RiverObs))
- Python modules, scripts for processing pixel clouds into river products
- You can use it!* 
  - *if you can get your hands on a pixel cloud



## Returning to example 

```{r}
include_graphics("fig-bordeaux/exmap-pixc.png")
```

## RiverObs Processing


```{r}
include_graphics("fig-bordeaux/exmap-pcv-class.png")
```

- Only deal with water pixels
- segment into disjoint features

## RiverObs processing


```{r}
include_graphics("fig-bordeaux/exmap-pcv-node.png")
```

- Assign to nodes (using prior database)
- Improve geolocation (Not shown here, requires CNES module)

## RiverObs processing

```{r}
include_graphics("fig-bordeaux/exmap-pcv-node.png")
```


## Node Height Aggregation

Pixel heights (interior water only)

```{r}
include_graphics("fig-bordeaux/node-agg-fig1.png")
```

## Node Height Aggregation

Resulting node heights (with 1-sigma uncertainty)

```{r}
include_graphics("fig-bordeaux/node-agg-fig2.png")
```

## Aside: Uncertainty validation




## Products


```{r}
include_graphics("fig-bordeaux/flowchart4-products.png")
```

- We'll see them in action in a minute!

## Products: PIXCVec

```{r}
include_graphics("fig-bordeaux/sidecar_annotated.jpg", dpi = 80)
```


## Products: Interactive Demo

- Link: [http://swot-riv-viz.shinyapps.io/riverproducts/](http://swot-riv-viz.shinyapps.io/riverproducts/)
  - also 
- ***Disclaimers***:
  - Processor, products not finalized
  - Simulated data may contain artifacts
  - App is not a SWOT product and is only intended for demonstration purposes
- **Tips**:
  - If you get disconnected, just reload the page. 

